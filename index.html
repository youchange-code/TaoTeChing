<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>老子智慧 · 道德經第一章</title>
    
    <!-- 1. 引入 Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 引入 React 和 React DOM (核心引擎) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. 引入 Babel (讓瀏覽器看懂 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 設定字體與背景 -->
    <style>
        body { font-family: "PingFang TC", "Microsoft JhengHei", serif; background-color: #f7f5f0; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 0. 圖標組件 (手動定義 SVG 以確保無需外部依賴) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Play: (props) => <Icon {...props} path={<polygon points="5 3 19 12 5 21 5 3"></polygon>} />,
            Pause: (props) => <Icon {...props} path={<><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></>} />,
            Upload: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></>} />,
            Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></>} />,
            Sparkles: (props) => <Icon {...props} path={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></>} />,
            Brain: (props) => <Icon {...props} path={<path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path>} />,
            Wind: (props) => <Icon {...props} path={<><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"></path><path d="M9.6 4.6A2 2 0 1 1 11 8H2"></path><path d="M12.6 19.4A2 2 0 1 0 14 16H2"></path></>} />,
            ScrollText: (props) => <Icon {...props} path={<><path d="M15 12h-5"></path><path d="M15 8h-5"></path><path d="M19 17V5a2 2 0 0 0-2-2H4"></path><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"></path></>} />,
            Lightbulb: (props) => <Icon {...props} path={<><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 12 2a4.65 4.65 0 0 0-4.5 9.5c.76.76 1.23 1.52 1.41 2.5"></path></>} />,
            Activity: (props) => <Icon {...props} path={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>} />,
            RefreshCw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></>} />,
            ChevronRight: (props) => <Icon {...props} path={<polyline points="9 18 15 12 9 6"></polyline>} />
        };

        // --- 1. 主要應用程式邏輯 ---
        const { useState, useRef, useEffect } = React;

        const TaoTeChingAppFinal = () => {
          const [activeTab, setActiveTab] = useState('analysis');
          
          // 預設檔案名稱
          const defaultFileName = "視頻抽取-老子智慧第一節.mp4";
          
          const [mediaSrc, setMediaSrc] = useState(defaultFileName);
          const [mediaType, setMediaType] = useState('video'); 
          const [isPlaying, setIsPlaying] = useState(false);
          const [mediaError, setMediaError] = useState(false); 
          const mediaRef = useRef(null);

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              const url = URL.createObjectURL(file);
              setMediaSrc(url);
              setMediaType(file.type.startsWith('video') ? 'video' : 'audio');
              setIsPlaying(false);
              setMediaError(false); 
            }
          };

          const togglePlay = () => {
            if (mediaRef.current) {
              if (isPlaying) {
                mediaRef.current.pause();
              } else {
                mediaRef.current.play();
              }
              setIsPlaying(!isPlaying);
            }
          };

          const handleMediaPlay = () => setIsPlaying(true);
          const handleMediaPause = () => setIsPlaying(false);
          const handleMediaError = () => {
            setMediaError(true);
            setIsPlaying(false);
          };

          return (
            <div className="min-h-screen bg-[#f7f5f0] text-stone-800 font-sans selection:bg-stone-300 flex flex-col">
              
              {/* 頂部控制列 */}
              <div className="bg-stone-900 text-[#f7f5f0] p-4 sticky top-0 z-50 shadow-lg shrink-0">
                <div className="max-w-3xl mx-auto flex flex-col gap-4">
                  <div className="flex justify-between items-center">
                    <div>
                      <h1 className="text-xl font-bold font-serif tracking-widest">老子智慧 · 第一章</h1>
                      <p className="text-xs text-stone-400">木清解讀 · 帛書版</p>
                    </div>
                    
                    <label className="flex items-center gap-2 bg-stone-800 hover:bg-stone-700 px-3 py-1.5 rounded-full cursor-pointer transition-colors text-xs border border-stone-600 group">
                      <Icons.Upload size={14} className="group-hover:text-[#d4cda5] transition-colors"/>
                      <span className="group-hover:text-white transition-colors">手動選擇檔案</span>
                      <input type="file" accept="audio/*,video/*" onChange={handleFileUpload} className="hidden" />
                    </label>
                  </div>

                  {/* 音訊模式迷你播放器 */}
                  {mediaType === 'audio' && !mediaError && (
                    <div className="bg-stone-800 rounded-lg p-3 flex items-center gap-4 border border-stone-700">
                      <button 
                        onClick={togglePlay}
                        disabled={mediaError}
                        className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors flex-shrink-0 ${!mediaError ? 'bg-[#d4cda5] text-stone-900 hover:bg-[#e8e4cc]' : 'bg-stone-700 text-stone-500 cursor-not-allowed'}`}
                      >
                        {isPlaying ? <Icons.Pause size={20} /> : <Icons.Play size={20} className="ml-1" />}
                      </button>
                      <div className="flex-1 overflow-hidden">
                        <div className="flex flex-col gap-1 w-full">
                          <span className="text-xs text-[#d4cda5] font-medium truncate">正在播放音訊模式</span>
                          <audio 
                            ref={mediaRef} 
                            src={mediaSrc} 
                            onError={handleMediaError}
                            onPlay={handleMediaPlay}
                            onPause={handleMediaPause}
                            onEnded={() => setIsPlaying(false)} 
                            className="w-full h-8 opacity-70" 
                            controls 
                          />
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* 主要內容 */}
              <div className="max-w-3xl mx-auto w-full p-4 pb-20 flex-grow">
                
                {/* 影片播放區域 */}
                {mediaType === 'video' && (
                  <div className="mb-6 rounded-xl overflow-hidden shadow-xl bg-black aspect-video relative group border border-stone-800">
                    {!mediaError ? (
                      <video 
                        ref={mediaRef}
                        src={mediaSrc}
                        onError={handleMediaError}
                        onPlay={handleMediaPlay}
                        onPause={handleMediaPause}
                        onEnded={() => setIsPlaying(false)}
                        className="w-full h-full object-contain"
                        controls
                        playsInline
                      />
                    ) : (
                      <div className="w-full h-full flex flex-col items-center justify-center text-stone-400 p-6 text-center bg-stone-900">
                        <Icons.AlertCircle size={48} className="mb-4 text-stone-600" />
                        <h3 className="text-lg font-bold text-stone-200 mb-2">未檢測到預設影片</h3>
                        <p className="text-sm max-w-md leading-relaxed mb-4">
                          請將影片命名為：<br/>
                          <code className="bg-stone-800 px-2 py-1 rounded text-[#d4cda5] mt-2 inline-block select-all">{defaultFileName}</code><br/>
                          並與本網頁放在同一資料夾，或使用上方按鈕手動上傳。
                        </p>
                      </div>
                    )}
                  </div>
                )}

                {/* 導航 */}
                <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
                  <NavButton active={activeTab === 'analysis'} onClick={() => setActiveTab('analysis')} icon={<Icons.Sparkles size={18} />} label="AI 智慧導讀" />
                  <NavButton active={activeTab === 'study'} onClick={() => setActiveTab('study')} icon={<Icons.BookOpen size={18} />} label="義理精講" />
                  <NavButton active={activeTab === 'quiz'} onClick={() => setActiveTab('quiz')} icon={<Icons.Brain size={18} />} label="悟道測驗" />
                  <NavButton active={activeTab === 'meditate'} onClick={() => setActiveTab('meditate')} icon={<Icons.Wind size={18} />} label="內觀修心" />
                </div>

                <div className="transition-opacity duration-300 min-h-[400px]">
                  {activeTab === 'analysis' && <AnalysisSection />}
                  {activeTab === 'study' && <StudySection />}
                  {activeTab === 'quiz' && <QuizSection />}
                  {activeTab === 'meditate' && <MeditationSection />}
                </div>

              </div>
            </div>
          );
        };

        // --- 子組件定義 ---

        const NavButton = ({ active, onClick, icon, label }) => (
          <button onClick={onClick} className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all flex-shrink-0 ${active ? 'bg-stone-800 text-[#f7f5f0] shadow-md transform scale-105' : 'bg-white text-stone-600 hover:bg-stone-200 border border-stone-200'}`}>
            {icon} {label}
          </button>
        );

        const AnalysisSection = () => (
          <div className="space-y-6 animate-fade-in">
            <div className="bg-gradient-to-br from-stone-800 to-stone-700 text-stone-100 p-6 rounded-2xl shadow-lg">
              <div className="flex items-start gap-3 mb-3">
                <Icons.Sparkles className="text-[#d4cda5] mt-1 flex-shrink-0" size={24} />
                <div>
                  <h2 className="text-xl font-bold font-serif mb-2 text-[#d4cda5]">本節課核心 AI 分析</h2>
                  <p className="text-sm leading-relaxed text-stone-300">本節課木清老師深度解讀《道德經》第一章，強調對「道」與「名」的理解應基於感受與變化，引導聽眾從內在覺知出發，認識自我天賦，走向無為而治的人生境界。</p>
                </div>
              </div>
            </div>
            <div className="grid gap-6 md:grid-cols-2">
              <div className="bg-white p-5 rounded-xl shadow-sm border border-stone-200">
                <div className="flex items-center gap-2 mb-3 border-b border-stone-100 pb-2">
                  <Icons.ScrollText size={18} className="text-stone-600" />
                  <h3 className="font-bold text-stone-800">歷史背景與版本</h3>
                </div>
                <ul className="space-y-3 text-sm text-stone-600">
                    <li className="flex gap-2"><span className="font-bold text-stone-800 min-w-[4rem]">老子地位：</span><span>東周典藏史，帝王之師。</span></li>
                    <li className="flex gap-2"><span className="font-bold text-stone-800 min-w-[4rem]">三家文化：</span><span>道家(帝者之學)、儒家(士大夫之學)、佛家(百姓之事)。</span></li>
                    <li className="flex gap-2"><span className="font-bold text-stone-800 min-w-[4rem]">帛書版：</span><span>推崇1973年馬王堆出土版本，接近老子原意。</span></li>
                </ul>
              </div>
              <div className="bg-white p-5 rounded-xl shadow-sm border border-stone-200">
                <div className="flex items-center gap-2 mb-3 border-b border-stone-100 pb-2">
                  <Icons.Lightbulb size={18} className="text-stone-600" />
                  <h3 className="font-bold text-stone-800">「道」與「名」的辯證</h3>
                </div>
                <div className="space-y-4 text-sm">
                  <div><span className="block font-bold text-stone-800 mb-1">道可道也，非恆道也</span><p className="text-stone-600">「可」意為感知。道是可以被感知的，但這種感知隨心境流變。</p></div>
                  <div><span className="block font-bold text-stone-800 mb-1">名可名也，非恆名也</span><p className="text-stone-600">名（定義）源於主觀感受，並非永恆，不應活在他人流變的評價中。</p></div>
                </div>
              </div>
            </div>
            <div className="bg-[#e8e4cc]/50 p-6 rounded-xl border border-[#d4cda5]">
              <h3 className="font-bold text-stone-800 mb-4 flex items-center gap-2"><Icons.Activity size={18} /><span>無與有：生命的雙重奏</span></h3>
              <div className="grid md:grid-cols-2 gap-6">
                <div><h4 className="font-bold text-stone-900 mb-2">無（萬物之始）</h4><p className="text-sm text-stone-700 mb-2">如孕婦腹中胎兒，蘊含潛能。是先天的頂層設計。<br/><span className="bg-white/60 px-1 rounded font-bold">無欲：</span>回歸先天本真慾望。</p></div>
                <div><h4 className="font-bold text-stone-900 mb-2">有（萬物之母）</h4><p className="text-sm text-stone-700 mb-2">如孩子出生，顯化於世。是後天的表現與執行。<br/><span className="bg-white/60 px-1 rounded font-bold">有欲：</span>觀察外在世界的邊界。</p></div>
              </div>
            </div>
          </div>
        );

        const StudySection = () => (
          <div className="space-y-6 animate-fade-in">
            <div className="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-stone-800">
              <h2 className="text-lg font-serif font-bold mb-4 text-stone-900 border-b pb-2">帛書版 · 道德經第一章</h2>
              <div className="text-xl md:text-2xl font-serif leading-relaxed text-stone-800 space-y-4">
                <p>道可道也，非恆道也。</p><p>名可名也，非恆名也。</p><p>無名萬物之始也；有名萬物之母也。</p><p>故恆無欲也，以觀其妙；</p><p>恆有欲也，以觀其所徼。</p><p>兩者同出，異名同謂。</p><p>玄之又玄，眾妙之門。</p>
              </div>
            </div>
            <div className="grid gap-4 md:grid-cols-2">
              <ConceptCard title="「可」字的真意" subtitle="丁 (權杖) + 口 (說話)" content="木清老師強調「可」代表向上天的祈求、感知和感覺。道是來自於你的「感受」和「覺知」。" color="bg-[#e8e4cc]" />
              <ConceptCard title="非恆道與非恆名" subtitle="變化是永恒的" content="定義和感受都不是一成不變的。如同父愛母愛隨年齡理解不同。不要活在別人暫時的評價裡。" color="bg-[#dcdcdc]" />
              <ConceptCard title="無與有" subtitle="始 vs 母" content="「無」是萬物之始（胎兒/天賦/頂層設計）；「有」是萬物之母（落地/職業/執行）。" color="bg-[#dcdcdc]" />
              <ConceptCard title="無欲 vs 有欲" subtitle="內求 vs 外求" content="無欲：閉目觀其妙（本心）；有欲：觀察邊界與表現。透過表象看本質。" color="bg-[#e8e4cc]" />
            </div>
          </div>
        );

        const ConceptCard = ({ title, subtitle, content, color }) => (
          <div className={`${color} p-5 rounded-xl shadow-sm hover:shadow-md transition-shadow`}>
            <h3 className="font-bold text-stone-800 text-lg mb-1">{title}</h3>
            <p className="text-xs font-bold text-stone-500 uppercase tracking-wider mb-3">{subtitle}</p>
            <p className="text-stone-700 text-sm leading-relaxed text-justify">{content}</p>
          </div>
        );

        const QuizSection = () => {
          const [currentQuestion, setCurrentQuestion] = useState(0);
          const [showAnswer, setShowAnswer] = useState(false);
          const questions = [
            { q: "根據木清老師，老子為什麼能寫出《道德經》？", options: ["因為道完全可以用語言說清楚", "因為道是可以被「感受」和「覺知」的", "因為他是圖書管理員"], correct: 1, explanation: "老師指出，傳統解釋「道不可言說」是邏輯悖論。「可」代表「感知」，道是可以被感知到的。" },
            { q: "「無」（無名）對應的是什麼狀態？", options: ["徹底的虛無", "萬物之母，顯化狀態", "萬物之始，如腹中胎兒"], correct: 2, explanation: "「無」等於「萬物之始」。就像禿頭毛囊還在，代表先天、含藏的狀態或頂層設計。" },
            { q: "朱元璋如何評價《道德經》？", options: ["一本古書", "王者之上師，臣民之極寶", "普通哲學書"], correct: 1, explanation: "朱元璋深刻體會《道德經》是「王者之上師，臣民之極寶，萬物之根」。" },
            { q: "什麼是真正的「無為」？", options: ["躺平不做事", "按先天頂層設計去作為", "隨波逐流"], correct: 1, explanation: "無為是找到自己的天賦（先天使命），順應它去努力，不做無謂的內耗。" }
          ];
          const handleNext = () => { setShowAnswer(false); setCurrentQuestion((prev) => (prev + 1) % questions.length); };
          const q = questions[currentQuestion];

          return (
            <div className="flex flex-col items-center justify-center animate-fade-in">
              <div className="w-full bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                <div className="bg-stone-800 p-4 text-[#f7f5f0] flex justify-between items-center"><span className="font-bold">悟道測驗</span><span className="text-sm opacity-70">第 {currentQuestion + 1} / {questions.length} 題</span></div>
                <div className="p-6 md:p-8">
                  <h3 className="text-xl font-bold text-stone-800 mb-6 leading-snug">{q.q}</h3>
                  <div className="space-y-3">
                    {q.options.map((opt, idx) => (
                      <button key={idx} onClick={() => setShowAnswer(true)} disabled={showAnswer} className={`w-full text-left p-4 rounded-xl border transition-all ${showAnswer ? idx === q.correct ? 'bg-green-100 border-green-500 text-green-800' : 'bg-stone-50 border-stone-200 text-stone-400' : 'hover:bg-stone-50 border-stone-200 text-stone-700'}`}>
                        <div className="flex items-start gap-3"><div className={`mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 text-xs ${showAnswer && idx === q.correct ? 'bg-green-500 border-green-500 text-white' : 'border-stone-400 text-stone-500'}`}>{String.fromCharCode(65 + idx)}</div><span>{opt}</span></div>
                      </button>
                    ))}
                  </div>
                  {showAnswer && (
                    <div className="mt-6 p-4 bg-[#e8e4cc] rounded-lg text-stone-800 border-l-4 border-stone-600 animate-fade-in">
                      <p className="font-bold text-sm mb-1">解析：</p><p>{q.explanation}</p>
                      <div className="mt-4 flex justify-end"><button onClick={handleNext} className="flex items-center gap-2 bg-stone-800 text-white px-4 py-2 rounded-lg hover:bg-stone-700 transition-colors">下一題 <Icons.ChevronRight size={16} /></button></div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        const MeditationSection = () => {
          const [seconds, setSeconds] = useState(0);
          const [active, setActive] = useState(false);
          useEffect(() => { let interval = null; if (active) { interval = setInterval(() => { setSeconds(s => s + 1); }, 1000); } else { clearInterval(interval); } return () => clearInterval(interval); }, [active]);
          return (
            <div className="flex flex-col items-center py-10 animate-fade-in">
              <div className="text-center mb-8 max-w-md"><h3 className="text-2xl font-serif font-bold text-stone-800 mb-2">故恆無欲也，以觀其妙</h3><p className="text-stone-600 leading-relaxed">講座中提到，「妙」字是「少了一隻眼睛」。<br/>請閉上眼睛，屏蔽外界（有欲）的干擾，向內觀照自己的初心與天賦（無欲）。</p></div>
              <div className="relative w-64 h-64 flex items-center justify-center">
                {active && <><div className="absolute w-full h-full rounded-full bg-[#d4cda5] opacity-20 animate-ping"></div><div className="absolute w-48 h-48 rounded-full bg-[#d4cda5] opacity-30 animate-pulse"></div></>}
                <div className="relative z-10 bg-white w-40 h-40 rounded-full flex flex-col items-center justify-center shadow-lg border-4 border-[#e8e4cc]"><span className="text-3xl font-serif font-bold text-stone-800">{Math.floor(seconds / 60)}:{String(seconds % 60).padStart(2, '0')}</span><span className="text-xs text-stone-400 mt-1 uppercase tracking-widest">{active ? '內觀中' : '準備'}</span></div>
              </div>
              <div className="mt-10 flex gap-4"><button onClick={() => setActive(!active)} className={`px-8 py-3 rounded-full text-lg font-medium transition-all ${active ? 'bg-stone-200 text-stone-600' : 'bg-stone-800 text-[#f7f5f0] hover:scale-105 shadow-lg'}`}>{active ? '暫停' : '開始靜心'}</button><button onClick={() => { setActive(false); setSeconds(0); }} className="p-3 rounded-full bg-white border border-stone-200 text-stone-500 hover:bg-stone-100 transition-colors"><Icons.RefreshCw size={20} /></button></div>
            </div>
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TaoTeChingAppFinal />);
    </script>
</body>
</html>

